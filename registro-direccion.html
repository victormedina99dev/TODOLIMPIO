<!DOCTYPE html>
<html lang="es-VE">
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="./css/todolimpio.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <title>Ubicación - TodoLimpio</title>
    <style>
        #map { height: 400px; width: 100%; border-radius: 15px; border: 3px solid #169ba4; margin-top: 20px; }
        .box { padding: 30px; text-align: center; }
    </style>
</head>
<body>
    <header style="background-color: #169ba4; padding: 10px; color: white; display: flex; align-items: center;">
        <img src="./imagenes/todolimpio-icono.png" alt="logo" width="50">
        <h2 style="margin-left: 15px;">TodoLimpio</h2>
    </header>

    <div class="container box">
        <h2 style="color: #169ba4;">¡Bienvenido!</h2>
        <p>Por favor, indica en el mapa dónde se encuentra tu hogar u oficina.</p>
        
        <div id="map"></div>
        
        <p class="mt-3"><strong>Ubicación detectada:</strong> <span id="ubicacion-actual">Cargando...</span></p>
        <input type="hidden" id="ubicacion_servicio_input">

        <button id="save-location" class="btn" style="background-color: #169ba4; color: white; border-radius: 50px; padding: 15px 40px; margin-top: 20px; border: none; cursor: pointer;">
            CONFIRMAR Y CONTINUAR
        </button>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="./js/mapa_servicio.js"></script>
    <script type="module">
        import { auth, db } from './js/firebase-config.js';
        import { doc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        document.getElementById('save-location').addEventListener('click', async () => {
            const user = auth.currentUser;
            const dir = document.getElementById('ubicacion_servicio_input').value;
            if (user && dir) {
                await setDoc(doc(db, "usuarios", user.uid), {
                    direccion: dir,
                    nombre: user.displayName,
                    email: user.email
                }, { merge: true });
                window.location.href = "todolimpio_solicitud_de_servicio.html";
            }
        });
    </script>
</body>
</html>